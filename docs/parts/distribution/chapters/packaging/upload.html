

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Uploading a package &mdash; Mastering Python</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/styles.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Mastering Python
          

          
            
            <img src="../../../../_static/logo-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20/03/2020
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../craftmanship/index.html">Craftmanship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structures_algorithms/index.html">Data structures and algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quality/index.html">Code quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../optimization/index.html">Code optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../technical_architecture/index.html">Technical architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../low_level/index.html">Low level Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Code distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references/index.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Mastering Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
      <li>3. Uploading a package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/parts/distribution/chapters/packaging/upload.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="uploading-a-package">
<h1>3. Uploading a package<a class="headerlink" href="#uploading-a-package" title="Permalink to this headline">¶</a></h1>
<p>Packages would be useless without an organized way to store, upload, and download
them. Python Package Index is the main source of open source packages in the Python
community. Anyone can freely upload new packages and the only requirement is to
register on the PyPI site: <a class="reference external" href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>.</p>
<p>You are not, of course, limited to only this index and all Python packaging tools support the
usage of alternative package repositories. This is especially useful for distributing closed
source code among internal organizations or for deployment purposes. Details of such
packaging usage with instructions on how to create your own package index will be
explained in the next chapter. Here we focus mainly on open source uploads to PyPI, with
only little mention on how to specify alternative repositories.</p>
<div class="section" id="pypi-python-package-index">
<h2>3.1. PyPI: Python Package Index<a class="headerlink" href="#pypi-python-package-index" title="Permalink to this headline">¶</a></h2>
<p>Python Package Index is, as already mentioned, the official source of open source package
distributions. Downloading from it does not require any account or permission. The only
thing you need is a package manager that can download new distributions from PyPI. Your
preferred choice should be <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<div class="section" id="uploading-to-pypi">
<h3>3.1.1. Uploading to PyPI<a class="headerlink" href="#uploading-to-pypi" title="Permalink to this headline">¶</a></h3>
<p>Anyone can register and upload packages to PyPI provided that he or she has an account
registered. Packages are bound to the user, so, by default, only the user that registered the
name of the package is its admin and can upload new distributions. This could be a
problem for bigger projects, so there is an option to mark other users as package
maintainers so that they are able to upload new distributions too.</p>
<p>The easiest way to upload a package is to use the following upload command of
the setup.py script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py &lt;dist-commands&gt; upload
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;dist-commands&gt;</span></code> is a list of commands that creates distributions to upload. Only
distributions created during the same <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> execution will be uploaded to the
repository. So, if you upload source distribution, built distribution, and <code class="docutils literal notranslate"><span class="pre">wheel</span></code> package at
once, then you need to issue the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py sdist bdist bdist_wheel upload
</pre></div>
</div>
<p>When uploading using <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, you cannot reuse distributions that were already built in
previous command calls and are forced to rebuild them on every upload. This may be
inconvenient for large or complex projects where creation of the actual distribution may
take a considerable amount of time. Another problem of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> upload is that it can
use plain text HTTP or unverified HTTPS connections on some Python versions. This is
why Twine is recommended as a secure replacement for the <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">upload</span></code> command.</p>
<p>Twine is the utility for interacting with PyPI that currently serves only one
purpose: securely uploading packages to the repository. It supports any packaging format
and always ensures that the connection is secure. It also allows you to upload files that
were already created, so you are able to test distributions before release. The following
example usage of twine still requires invoking the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script for building
distributions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py sdist bdist_wheel
$ twine upload dist/*
</pre></div>
</div>
</div>
<div class="section" id="pypirc">
<h3>3.1.2. .pypirc<a class="headerlink" href="#pypirc" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.pypirc</span></code> is a configuration file that stores information about Python packages repositories.
It should be located in your home directory. The format for this file is as follows:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[distutils]</span>
<span class="na">index-servers</span> <span class="o">=</span><span class="s"></span>
<span class="s">    pypi</span>
<span class="s">    other</span>

<span class="k">[pypi]</span>
<span class="na">repository: &lt;repository-url&gt;</span>
<span class="na">username: &lt;username&gt;</span>
<span class="na">password: &lt;password&gt;</span>

<span class="k">[other]</span>
<span class="na">repository: https://example.com/pypi</span>
<span class="na">username: &lt;username&gt;</span>
<span class="na">password: &lt;password&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">distutils</span></code> section should have the <code class="docutils literal notranslate"><span class="pre">index-servers</span></code> variable that lists all sections
describing all the available repositories and credentials for them. There are only the
following three variables that can be modified for each repository section:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">repository</span></code>: This is the URL of the package repository (it defaults to <a class="reference external" href="https://pypi.org">https://pypi.org/</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code>: This is the username for authentication in the given repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: This is the user password for authentication in the given repository (in plain text).</p></li>
</ul>
<p>Note that storing your repository password in plain text may not be the wisest security
choice. You can always leave it blank and you should be prompted for it whenever it is
necessary.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.pypirc</span></code> file should be respected by every packaging tool built for Python. While this
may not be true for every packaging-related utility out there, it is supported by the most
important ones, such as <code class="docutils literal notranslate"><span class="pre">pip</span></code>, <code class="docutils literal notranslate"><span class="pre">twine</span></code>, <code class="docutils literal notranslate"><span class="pre">distutils</span></code> and <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>.</p>
</div>
</div>
<div class="section" id="source-packages-versus-built-packages">
<h2>3.2. Source packages versus built packages<a class="headerlink" href="#source-packages-versus-built-packages" title="Permalink to this headline">¶</a></h2>
<p>There are generally the following two types of distributions for Python packages:</p>
<ul class="simple">
<li><p>Source distributions</p></li>
<li><p>Built (binary) distributions</p></li>
</ul>
<p>Source distributions are the simplest and most platform independent. For pure Python
packages, it is a no-brainer. Such a distribution contains only Python sources and these
should already be highly portable.</p>
<p>A more complex situation is when your package introduces some extensions written, for
example, in C. Source distributions will still work provided that the package user has
proper development toolchain in his/her environment. This consists mostly of the compiler
and proper C header files. For such cases, the build distribution format may be better suited
because it can provide already built extensions for specific platforms.</p>
</div>
<div class="section" id="sdist">
<h2>3.2.1. sdist<a class="headerlink" href="#sdist" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sdist</span></code> command is the simplest command available. It creates a release tree where
everything that is needed to run the package is copied to. This tree is then archived in one
or many archived files (often, it just creates one tarball). The archive is basically a copy of
the source tree.</p>
<p>This command is the easiest way to distribute a package that would be independent from
the target system. It creates a <code class="docutils literal notranslate"><span class="pre">dist/</span></code> directory for storing the archives to be distributed.
Before you create the first distribution, you have to provide a <code class="docutils literal notranslate"><span class="pre">setup()</span></code> call with a version
number, as follows. If you don’t, <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> module will assume default value
of <code class="docutils literal notranslate"><span class="pre">version</span> <span class="pre">=</span> <span class="pre">'0.0.0'</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;acme.sql&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.1.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Every time a package is released, the version number should be increased so that the target
system knows the package has changed.</p>
<p>Let’s run the following <code class="docutils literal notranslate"><span class="pre">sdist</span></code> command for <code class="docutils literal notranslate"><span class="pre">acme.sql</span></code> package in <code class="docutils literal notranslate"><span class="pre">0.1.1</span></code> version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py sdist
running sdist
...
creating dist
tar -cf dist/acme.sql-0.1.1.tar acme.sql-0.1.1
gzip -f9 dist/acme.sql-0.1.1.tar
removing <span class="s1">&#39;acme.sql-0.1.1&#39;</span> <span class="o">(</span>and everything under it<span class="o">)</span>

$ ls dist/
acme.sql-0.1.1.tar.gz
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Windows, the default archive type will be ZIP.</p>
</div>
<p>The version is used to mark the name of the archive, which can be distributed and installed
on any system that has Python. In the <code class="docutils literal notranslate"><span class="pre">sdist</span></code> distribution, if the package contains C libraries
or extensions, the target system is responsible for compiling them. This is very common for
Linux-based systems or macOS because they commonly provide a compiler. But it is less
usual to have it under Windows. That’s why a package should always be distributed with a
prebuilt distribution as well, when it is intended to be run on several platforms.</p>
<div class="section" id="bdist-and-wheels">
<h3>3.2.2. bdist and wheels<a class="headerlink" href="#bdist-and-wheels" title="Permalink to this headline">¶</a></h3>
<p>To be able to distribute a prebuilt distribution, <code class="docutils literal notranslate"><span class="pre">distutils</span></code> provides the <code class="docutils literal notranslate"><span class="pre">build</span></code> command.
This commands compiles the package in the following four steps:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">build_py</span></code>: This builds pure Python modules by byte-compiling them and copying them into the build folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_clib</span></code>: This builds C libraries, when the package contains any, using Python compiler and creating a static library in the build folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_ext</span></code>: This builds C extensions and puts the result in the build folder like <code class="docutils literal notranslate"><span class="pre">build_clib</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build_scripts</span></code>: This builds the modules that are marked as scripts. It also changes the interpreter path when the first line was set (using <code class="docutils literal notranslate"><span class="pre">!#</span></code> prefix) and fixes the file mode so that it is executable.</p></li>
</ul>
<p>Each of these steps is a command that can be called independently. The result of the
compilation process is a <code class="docutils literal notranslate"><span class="pre">build</span></code> folder that contains everything needed for the package to be
installed. There’s no cross-compiler option yet in the <code class="docutils literal notranslate"><span class="pre">distutils</span></code> package. This means that
the result of the command is always specific to the system it was built on.</p>
<p>When some C extensions have to be created, the build process uses the default system
compiler and the Python header file (<code class="docutils literal notranslate"><span class="pre">Python.h</span></code>). This include file is available from the time
Python was built from the sources. For a packaged distribution, an extra package for your
system distribution is probably required. At least in popular Linux distributions, it is often
named <code class="docutils literal notranslate"><span class="pre">python-dev</span></code>. It contains all the necessary header files for building Python
extensions.</p>
<p>The C compiler used in the build process is the compiler that is default for your operating
system. For a Linux-based system or macOS, this would be gcc or clang respectively. For
Windows, Microsoft Visual C++ can be used (there’s a free command-line version
available). The open source project MinGW can be used as well. This can be configured
in <code class="docutils literal notranslate"><span class="pre">distutils</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">build</span></code> command is used by the <code class="docutils literal notranslate"><span class="pre">bdist</span></code> command to build a binary distribution. It
invokes <code class="docutils literal notranslate"><span class="pre">build</span></code> and all the dependent commands, and then creates an archive in the same
way as <code class="docutils literal notranslate"><span class="pre">sdist</span></code> does.</p>
<p>Let’s create a binary distribution for <code class="docutils literal notranslate"><span class="pre">acme.sql</span></code> on macOS as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py bdist
running bdist
running bdist_dumb
running build
...
running install_scripts
tar -cf dist/acme.sql-0.1.1.macosx-10.3-fat.tar .
gzip -f9 acme.sql-0.1.1.macosx-10.3-fat.tar
removing <span class="s1">&#39;build/bdist.macosx-10.3-fat/dumb&#39;</span> <span class="o">(</span>and everything under it<span class="o">)</span>

$ ls dist/
acme.sql-0.1.1.macosx-10.3-fat.tar.gz
acme.sql-0.1.1.tar.gz
</pre></div>
</div>
<p>Notice that the newly created archive’s name contains the name of the system and the
distribution it was built on (macOS 10.3).</p>
<p>The same command invoked on Windows will create a another system, specific distribution
archive as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\a</span>cme.sql&gt; python.exe setup.py bdist
...

C:<span class="se">\a</span>cme.sql&gt; dir dist
<span class="m">25</span>/02/2008      <span class="m">08</span>:18       &lt;DIR&gt;       .
<span class="m">25</span>/02/2008      <span class="m">08</span>:18       &lt;DIR&gt;       ..
<span class="m">25</span>/02/2008      <span class="m">08</span>:24                   <span class="m">16</span> <span class="m">055</span> acme.sql-0.1.1.win32.zip
                    <span class="m">1</span> File<span class="o">(</span>s<span class="o">)</span>   <span class="m">16</span> <span class="m">055</span> bytes
                    <span class="m">2</span> Dir<span class="o">(</span>s<span class="o">)</span>    <span class="m">22</span> <span class="m">239</span> <span class="m">752</span> <span class="m">192</span> bytes free
</pre></div>
</div>
<p>If a package contains C code, apart from a source distribution, it’s important to release as
many different binary distributions as possible. At the very least, a Windows binary
distribution is important for those who most probably don’t have a C compiler installed.</p>
<p>A binary release contains a tree that can be copied directly into the Python tree. It mainly
contains a folder that is copied into Python’s <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> folder. It may also contain
cached bytecode files (<code class="docutils literal notranslate"><span class="pre">*.pyc</span></code> files on Python 2 and <code class="docutils literal notranslate"><span class="pre">__pycache__/*.pyc</span></code> on Python 3).</p>
<p>The other kind of build distributions are wheels provided by the <code class="docutils literal notranslate"><span class="pre">wheel</span></code> package. When
installed (for example, using <code class="docutils literal notranslate"><span class="pre">pip</span></code>), the wheel package adds a new <code class="docutils literal notranslate"><span class="pre">bdist_wheel</span></code> command
to the <code class="docutils literal notranslate"><span class="pre">distutils</span></code>. It allows creating platform specific distributions (currently only for
Windows, macOS, and Linux) that are better alternatives to normal bdist distributions. It
was designed to replace another distribution format introduced earlier
by <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> called eggs. Eggs are now obsolete, so won’t be featured in here. The
list of advantages of using wheels is quite long. Here are the ones that are mentioned on the
Python Wheels page (<a class="reference external" href="http://pythonwheels.com">http://pythonwheels.com/</a>):</p>
<ul class="simple">
<li><p>Faster installation for pure Python and native C extension packages</p></li>
<li><p>Avoids arbitrary code execution for installation. (avoids <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>)</p></li>
<li><p>Installation of a C extension does not require a compiler on Windows, macOS, or Linux.</p></li>
<li><p>Allows better caching for testing and continuous integration.</p></li>
<li><p>Creates <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files as part of the installation to ensure they match the Python interpreter used</p></li>
<li><p>More consistent installs across platforms and machines</p></li>
</ul>
<p>According to PyPA’s recommendation, wheels should be your default distribution format.
For a very long time, the binary wheels for Linux were not supported, but that has changed
fortunately. Binary wheels for Linux are called manylinux wheels. The process of building
them is unfortunately not as straightforward as for Windows and macOS binary wheels.
For these kind of wheels, PyPA maintains special Docker images that serve as a ready-to-
use build environments. For sources of these images and more information, you can visit
their official repository on GitHub: <a class="reference external" href="https://github.com/pypa/manylinux">https://github.com/pypa/manylinux</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Sergio Bugallo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>